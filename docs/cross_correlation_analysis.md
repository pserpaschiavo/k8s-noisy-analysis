# Cross-Correlation in Multi-Tenant Analysis

## Overview

Cross-correlation (Cross-Correlation Function - CCF) is a powerful technique for analyzing temporal relationships between series, identifying not only if two series are correlated, but also if there is a lag in that relationship. This document explains how to use and interpret the cross-correlation plots generated by the pipeline.

## Implemented Functionality

The cross-correlation functionality was implemented in the `analysis_correlation.py` module and is now integrated into the main pipeline through the `CorrelationAnalysisStage`. The generated plots are stored in the directory:

```
outputs/demo-experiment-1-round/plots/correlation/cross_correlation/
```

## How to Run

To generate cross-correlation plots, run the unified pipeline:

```bash
python -m src.run_unified_pipeline --config config/pipeline_config.yaml
```

## Interpreting Cross-Correlation Plots

Cross-correlation plots show:

1.  **X-axis**: Lag between the time series, from -N to +N
    -   Negative lag: the second tenant influences the first
    -   Zero lag: contemporary correlation (no lag)
    -   Positive lag: the first tenant influences the second

2.  **Y-axis**: Correlation value between the series for each lag
    -   Values close to +1 indicate strong positive correlation
    -   Values close to -1 indicate strong negative correlation
    -   Values close to 0 indicate weak or no correlation

3.  **Red Marker**: Indicates the point of greatest correlation in absolute value
    -   The annotation indicates the correlation value and the lag where it occurs
    -   Suggests the optimal lag between the time series

4.  **Gray Band**: Represents an approximate confidence interval
    -   Values within this band may not be statistically significant

5.  **Title**: Includes directional information based on the lag of greatest correlation
    -   "A → B" indicates that A tends to influence B
    -   "B → A" indicates that B tends to influence A
    -   "Contemporary" indicates that the highest correlation occurs without a lag

## Analysis Example

An example of interpretation:

-   If the plot shows maximum correlation at lag +3 for tenant-a and tenant-b:
    -   This suggests that changes in the activity of tenant-a precede similar changes in tenant-b by 3 periods
    -   It may indicate a causal relationship or influence of tenant-a on tenant-b

-   If the maximum value occurs at a negative lag:
    -   It suggests that the second tenant influences the first
    -   A lag of -2 between tenant-c and tenant-d would indicate that tenant-d influences tenant-c with a 2-period lead

## Importance for Multi-Tenant Analysis

Cross-correlation is particularly valuable for:

1.  **Identifying the noisy tenant**: Tenants that systematically influence others with positive lags are potential candidates for "noisy tenants"

2.  **Propagation of effects**: Understanding how long it takes for the behavior of one tenant to affect others

3.  **Mitigation planning**: Knowing the time lag allows for more effective preventive actions

## Limitations

-   CCF only identifies linear relationships between time series
-   It does not prove causality, only suggests temporal relationships
-   Very long lags can be spurious or coincidental
